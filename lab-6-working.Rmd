---
title: "lab-7-working"
author: "Vienna Saccomanno"
date: "2/21/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(tmap)
library(sf)
library(spatstat)
library(maptools)
library(sp)
library(raster)
# library(rgdal)
library(gstat)
library(plotKML) # for points to raster (they won't have this...just testing)
```

###Part 1. Hawaii raster intro

```{r}

# Read in the raster data because sf is only set up for vector data

hi_par <- raster("PAR_CLIM_M.tif")
hi_sst <- raster("SST_LTM.tif")
hi_chl <- raster("CHL_LTM.tif")
  
# Base plots
plot(hi_par)
plot(hi_sst)
plot(hi_chl)

par(mrow = c(1,3))
plot(hi_par)
plot(hi_sst)
plot(hi_chl)

#hi_sst - tells you about the data = raster

```

First: some useful functions for rasters

Checking it out: 

- crs
- reprojection
- cropping
- simple algebra example


```{r}

hi_sst@crs # Shows CRS(coordinate reference system): NAD83

hi_sst@extent # Shows extent (bounds)

```

Example: reprojection to WGS84
```{r}
wgs84 = "+proj=longlat +datum=WGS84 +ellps=WGS84 +no_defs" # Projection information, Just have this ready to copy/paste

# Reproject hi_sst to be WGS84. Biliner = liner interpertation in to directions
hi_sst_84 = projectRaster(hi_sst, crs = wgs84, method = "bilinear")

# Check the reprojection - looks good
hi_sst_84@crs
hi_sst_84@extent #now the lat long are in familiar units

```

raster::aggregate() for resampling to make files size smaller
```{r}

# Sea surface temperature: 
sst_rs <- aggregate(hi_sst, fact = 10) #Decreasing resolution by order of 10, Quick way to resample. Raster data files can get super massive and if you just want to test code, might want to resample to make things quicker.

plot(sst_rs)

# Plot side-by-side for comparison:
par(mfrow = c(1,2))
plot(hi_sst)
plot(sst_rs)

```

Crop a raster: 
```{r}

#what are the current extents?, get the bounding box for the raster
hi_sst_84@extent

# Get these extents from hi_sst_84 (call in console to see) what the actual limits are for hi_sst_84, then decide on cropping boundaries. Allison chose a Hawaiian island for this lab.

# First create a spatial polygon. as() forces this to be a spatial polygon.
bounds <- as(extent(-156.2, -154.5, 18.7, 20.4), 'SpatialPolygons') # Keep in mind, this could be any polygon shape (state outline, county outline, etc.) 'spatialPolygons', tells R to convert to spatial polygons. We're cropping to a rectangle, but we could have pulled in shapefile data and cropped accordingly.

# Reproject - if no projection this is the easy way to do this. Making crs of "bounds" match the crs of hi_sst_84. Need them to match in order to do math with them. Bounds = polygon, hi_sst_84= raster.
crs(bounds) <- crs(hi_sst_84)

# Then crop the raster by the polygon bounds 
sst_crop <- crop(hi_sst_84, bounds)

# And plot:
plot(sst_crop)
```


A simple algebra example/ raster math: 

Let's say we're creating a nonsensical variable called "tropicality", which is the sum of the PAR + SST + 2*ChlA. How can we create a layer for tropicality? How do we map?

First let's reprojeect and get everything into the same CRS:

Use method = "bilinear" for continuous variables, "ngm" for categorical
```{r}

hi_par_84 <- projectRaster(hi_par, crs = wgs84, method = "bilinear")

hi_chla_84 <- projectRaster(hi_chl, crs = wgs84, method = "bilinear")

# Now we have PAR, Chl-a, and SST all in the same CRS (WGS84) and can start doing some simple algebra. 
```
